<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Diffraction Grating</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.9.0/p5.min.js"></script>
  <style>
    body { margin: 0; padding: 0; overflow: hidden; background: #000; }
    canvas { display: block; }
  </style>
</head>
<body>
<script>
// Diffraction Grating - Light spectrum visualization
// Creates rainbow interference patterns

let t = 0;
const SLIT_COUNT = 12;
let slits = [];

function setup() {
  createCanvas(windowWidth, windowHeight);
  colorMode(HSB, 360, 100, 100, 1);
  noStroke();
  
  // Initialize slit positions
  for (let i = 0; i < SLIT_COUNT; i++) {
    slits.push({
      x: map(i, 0, SLIT_COUNT - 1, width * 0.2, width * 0.8),
      phase: random(TWO_PI)
    });
  }
}

function draw() {
  background(0, 0, 5);
  
  const centerY = height / 2;
  const maxDist = height * 0.4;
  
  // Draw interference pattern
  for (let y = 0; y < height; y += 2) {
    let distFromCenter = abs(y - centerY);
    if (distFromCenter > maxDist) continue;
    
    let intensity = 0;
    let hue = 0;
    
    // Calculate interference from all slits
    for (let s of slits) {
      let d = dist(s.x, centerY, width / 2, y);
      let phase = (d * 0.02) + t + s.phase;
      let contribution = sin(phase) * 0.5 + 0.5;
      
      // Distance-based falloff
      let falloff = map(distFromCenter, 0, maxDist, 1, 0);
      intensity += contribution * falloff;
      
      // Hue based on angle from center
      hue += (s.x - width/2) * contribution;
    }
    
    intensity /= SLIT_COUNT;
    hue = map(hue / SLIT_COUNT, -width/2, width/2, 0, 360);
    
    let sat = map(intensity, 0, 1, 30, 100);
    let bri = map(intensity, 0, 1, 5, 100);
    
    fill(hue, sat, bri, 0.8);
    rect(0, y, width, 2);
  }
  
  // Draw slit indicators
  fill(0, 0, 100);
  for (let s of slits) {
    ellipse(s.x, centerY, 4, 4);
  }
  
  t += 0.02;
}

function windowResized() {
  resizeCanvas(windowWidth, windowHeight);
  slits = [];
  for (let i = 0; i < SLIT_COUNT; i++) {
    slits.push({
      x: map(i, 0, SLIT_COUNT - 1, width * 0.2, width * 0.8),
      phase: random(TWO_PI)
    });
  }
}
</script>
</body>
</html>
