<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Terrain Drift</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.9.0/p5.min.js"></script>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { overflow: hidden; background: #0a0a0f; }
    canvas { display: block; }
  </style>
</head>
<body>
<script>
// Terrain Drift - 3D Perlin noise landscape with gentle drift
let cols, rows;
let scl = 20;
let w = 1400;
let h = 1000;
let flying = 0;
let terrain = [];
let time = 0;

function setup() {
  createCanvas(windowWidth, windowHeight, WEBGL);
  cols = w / scl;
  rows = h / scl;
  
  // Initialize terrain
  for (let y = 0; y <= rows; y++) {
    terrain[y] = [];
    for (let x = 0; x <= cols; x++) {
      terrain[y][x] = 0;
    }
  }
}

function draw() {
  flying -= 0.02;
  time += 0.008;
  
  let yoff = flying;
  for (let y = 0; y <= rows; y++) {
    let xoff = 0;
    for (let x = 0; x <= cols; x++) {
      let elevation = map(noise(xoff, yoff, time), 0, 1, -150, 150);
      
      // Add secondary noise layer for detail
      elevation += map(noise(xoff * 3, yoff * 3, time * 0.5), 0, 1, -50, 50);
      
      terrain[y][x] = elevation;
      xoff += 0.1;
    }
    yoff += 0.1;
  }
  
  // Deep space gradient background
  background(8, 6, 18);
  
  // Ambient light
  ambientLight(40, 45, 60);
  
  // Directional light (sun/moon)
  directionalLight(255, 240, 200, 0.5, 0.5, -1);
  directionalLight(100, 150, 255, -0.5, 0.3, 0.5);
  
  // Point light for glow
  pointLight(255, 100, 150, 0, -200, 100);
  
  // Rotate to look at terrain
  rotateX(PI / 3);
  translate(-w / 2, -h / 2 + 50);
  
  // Color palette based on elevation
  for (let y = 0; y < rows; y++) {
    beginShape(TRIANGLE_STRIP);
    for (let x = 0; x < cols; x++) {
      let x1 = x * scl;
      let y1 = y * scl;
      let x2 = x * scl;
      let y2 = (y + 1) * scl;
      
      let elev1 = terrain[y][x];
      let elev2 = terrain[y + 1][x];
      
      // Vertex 1
      let c1 = getColor(elev1);
      fill(c1);
      noStroke();
      vertex(x1, y1, elev1);
      
      // Vertex 2
      let c2 = getColor(elev2);
      fill(c2);
      vertex(x2, y2, elev2);
    }
    endShape();
  }
  
  // Add fog overlay
  push();
  translate(0, 0, -50);
  fill(8, 6, 18, 50);
  rect(-w, -h, w * 3, h * 3);
  pop();
}

function getColor(elevation) {
  // Map elevation to color gradient
  let t = map(elevation, -200, 200, 0, 1);
  
  // Deep colors
  let deepWater = color(10, 20, 60);
  let shallowWater = color(20, 60, 100);
  let lowland = color(30, 50, 40);
  let grassland = color(60, 100, 50);
  let highlands = color(100, 80, 60);
  let mountain = color(140, 130, 120);
  let snow = color(240, 245, 255);
  
  if (t < 0.2) return lerpColor(deepWater, shallowWater, t / 0.2);
  if (t < 0.35) return lerpColor(shallowWater, lowland, (t - 0.2) / 0.15);
  if (t < 0.5) return lerpColor(lowland, grassland, (t - 0.35) / 0.15);
  if (t < 0.7) return lerpColor(grassland, highlands, (t - 0.5) / 0.2);
  if (t < 0.9) return lerpColor(highlands, mountain, (t - 0.7) / 0.2);
  return lerpColor(mountain, snow, (t - 0.9) / 0.1);
}

function windowResized() {
  resizeCanvas(windowWidth, windowHeight);
}
</script>
</body>
</html>
