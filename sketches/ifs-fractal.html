<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>IFS Fractal — p5 Art Dreams</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.9.0/p5.min.js"></script>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { 
      background: #0a0a0f; 
      overflow: hidden;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
    }
    canvas { display: block; }
  </style>
</head>
<body>
<script>
// IFS Fractal — Iterated Function System with rotating transforms
// Creates self-similar patterns using probabilistic affine transformations

let points = [];
let maxPoints = 80000;
let palette;
let baseHue;

function setup() {
  createCanvas(windowWidth, windowHeight);
  colorMode(HSB, 360, 100, 100, 100);
  background(240, 20, 5);
  
  baseHue = random(360);
  palette = generatePalette(baseHue);
  
  // Initialize points at center
  for (let i = 0; i < 1000; i++) {
    let x = random(-1, 1);
    let y = random(-1, 1);
    points.push({ x, y, color: random(palette) });
  }
  
  noStroke();
}

function draw() {
  // Semi-transparent background for trails
  fill(240, 20, 5, 2);
  rect(0, 0, width, height);
  
  let scale = min(width, height) * 0.4;
  let cx = width / 2;
  let cy = height / 2;
  
  // Generate new points
  for (let i = 0; i < 500; i++) {
    if (points.length >= maxPoints) break;
    
    let p = random(points);
    let r = random(1);
    
    let nx, ny;
    
    // Barnsley fern-inspired transforms with variations
    if (r < 0.01) {
      nx = 0;
      ny = 0.16 * p.y;
    } else if (r < 0.86) {
      nx = 0.85 * p.x + 0.04 * p.y;
      ny = -0.04 * p.x + 0.85 * p.y + 1.6;
    } else if (r < 0.93) {
      nx = 0.2 * p.x - 0.26 * p.y;
      ny = 0.23 * p.x + 0.22 * p.y + 1.6;
    } else {
      nx = -0.15 * p.x + 0.28 * p.y;
      ny = 0.26 * p.x + 0.24 * p.y + 0.44;
    }
    
    // Add rotation based on time
    let angle = sin(frameCount * 0.01) * 0.1;
    let rx = nx * cos(angle) - ny * sin(angle);
    let ry = nx * sin(angle) + ny * cos(angle);
    
    let newPoint = { x: rx, y: ry, color: p.color };
    points.push(newPoint);
    
    // Draw point
    let screenX = cx + rx * scale;
    let screenY = cy - ry * scale;
    
    if (screenX > 0 && screenX < width && screenY > 0 && screenY < height) {
      fill(newPoint.color);
      ellipse(screenX, screenY, 1.2, 1.2);
    }
  }
  
  // Slowly shift palette
  if (frameCount % 60 === 0) {
    baseHue = (baseHue + 0.5) % 360;
    palette = generatePalette(baseHue);
  }
}

function generatePalette(baseH) {
  let cols = [];
  for (let i = 0; i < 20; i++) {
    let h = (baseH + i * 18) % 360;
    let s = 70 + sin(i * 0.5) * 20;
    let b = 80 + cos(i * 0.3) * 15;
    cols.push(color(h, s, b, 70));
  }
  return cols;
}

function windowResized() {
  resizeCanvas(windowWidth, windowHeight);
  background(240, 20, 5);
  points = [];
  for (let i = 0; i < 1000; i++) {
    let x = random(-1, 1);
    let y = random(-1, 1);
    points.push({ x, y, color: random(palette) });
  }
}
</script>
</body>
</html>
