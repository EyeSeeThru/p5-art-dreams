<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Double Pendulum Chaos</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.9.0/p5.min.js"></script>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { overflow: hidden; background: #000; }
    canvas { display: block; }
  </style>
</head>
<body>
<script>
// Double Pendulum Chaos
// Exploring chaotic motion through Lagrangian mechanics

let theta1, theta2;
let omega1, omega2;
let length1, length2;
let mass1, mass2;
let g = 1;
let trail = [];
const MAX_TRAIL = 500;
let hueOffset = 0;

function setup() {
  createCanvas(windowWidth, windowHeight);
  colorMode(HSB, 360, 100, 100, 100);
  
  // Initial conditions - slight asymmetry for interesting chaos
  theta1 = PI / 2;
  theta2 = PI / 2 + 0.1;
  omega1 = 0;
  omega2 = 0;
  
  // Lengths and masses
  length1 = min(width, height) * 0.15;
  length2 = min(width, height) * 0.15;
  mass1 = 20;
  mass2 = 20;
  
  background(0);
}

function draw() {
  // Semi-transparent background for glow effect
  background(0, 0, 0, 5);
  
  // Physics calculations using Lagrangian mechanics
  let num1 = -g * (2 * mass1 + mass2) * sin(theta1);
  let num2 = -mass2 * g * sin(theta1 - 2 * theta2);
  let num3 = -2 * sin(theta1 - theta2) * mass2;
  let num4 = omega2 * omega2 * length2 + omega1 * omega1 * length1 * cos(theta1 - theta2);
  let den = length1 * (2 * mass1 + mass2 - mass2 * cos(2 * theta1 - 2 * theta2));
  
  let alpha1 = (num1 + num2 + num3 * num4) / den;
  
  num1 = 2 * sin(theta1 - theta2);
  num2 = omega1 * omega1 * length1 * (mass1 + mass2);
  num3 = g * (mass1 + mass2) * cos(theta1);
  num4 = omega2 * omega2 * length2 * mass2 * cos(theta1 - theta2);
  den = length2 * (2 * mass1 + mass2 - mass2 * cos(2 * theta1 - 2 * theta2));
  
  let alpha2 = (num1 * (num2 + num3 + num4)) / den;
  
  // Apply angular accelerations
  omega1 += alpha1 * 0.1;
  omega2 += alpha2 * 0.1;
  
  // Damping
  omega1 *= 0.999;
  omega2 *= 0.999;
  
  // Update angles
  theta1 += omega1 * 0.1;
  theta2 += omega2 * 0.1;
  
  // Calculate bob positions
  let x1 = length1 * sin(theta1);
  let y1 = length1 * cos(theta1);
  let x2 = x1 + length2 * sin(theta2);
  let y2 = y1 + length2 * cos(theta2);
  
  // Translate to center
  push();
  translate(width / 2, height / 2);
  
  // Draw trail
  trail.push({ x: x2, y: y2, hue: (hueOffset + frameCount * 0.1) % 360 });
  if (trail.length > MAX_TRAIL) trail.shift();
  
  noFill();
  beginShape();
  for (let i = 0; i < trail.length; i++) {
    let t = i / trail.length;
    let alpha = t * 80;
    stroke((trail[i].hue) % 360, 80, 90, alpha);
    strokeWeight(2 * t + 0.5);
    vertex(trail[i].x, trail[i].y);
  }
  endShape();
  
  // Draw pivot point
  noStroke();
  fill(0, 0, 40);
  ellipse(0, 0, 10, 10);
  
  // Draw rods
  stroke(0, 0, 60);
  strokeWeight(2);
  line(0, 0, x1, y1);
  line(x1, y1, x2, y2);
  
  // Draw masses
  fill((hueOffset + 180) % 360, 70, 100);
  ellipse(x1, y1, mass1, mass1);
  
  fill((hueOffset + frameCount * 0.2) % 360, 80, 100);
  ellipse(x2, y2, mass2, mass2);
  
  pop();
  
  // Slow color shift
  hueOffset += 0.2;
}

function windowResized() {
  resizeCanvas(windowWidth, windowHeight);
  length1 = min(width, height) * 0.15;
  length2 = min(width, height) * 0.15;
  background(0);
  trail = [];
}

function mousePressed() {
  // Reset on click
  theta1 = random(TWO_PI);
  theta2 = random(TWO_PI);
  omega1 = 0;
  omega2 = 0;
  trail = [];
}
</script>
</body>
</html>
