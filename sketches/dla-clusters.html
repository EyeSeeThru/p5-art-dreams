<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>DLA Clusters</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.9.0/p5.min.js"></script>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { overflow: hidden; background: #0a0a0f; }
    canvas { display: block; }
  </style>
</head>
<body>
<script>
// DLA Clusters - Diffusion Limited Aggregation
// Particles wander randomly until they stick to existing clusters

let particles = [];
let clusters = [];
let stuckParticles = [];
let numParticles = 2000;
let stuckCount = 0;
let maxAttempts = 100;
let radius = 2;
let colorPalette;
let animating = true;

function setup() {
  createCanvas(windowWidth, windowHeight);
  colorMode(HSB, 360, 100, 100, 1);
  background(10);
  
  // Rich dark palette with jewel tones
  colorPalette = [
    color(340, 80, 90),  // Magenta
    color(280, 70, 80),  // Purple
    color(200, 80, 90),  // Cyan
    color(160, 70, 80),  // Teal
    color(40, 90, 100),  // Gold
    color(10, 80, 95),   // Coral
    color(320, 60, 85),  // Pink
  ];
  
  // Start with a seed cluster in center
  let centerX = width / 2;
  let centerY = height / 2;
  
  // Create initial seed
  stuckParticles.push({
    x: centerX,
    y: centerY,
    col: colorPalette[0]
  });
  
  // Draw seed
  noStroke();
  fill(colorPalette[0]);
  circle(centerX, centerY, radius * 2);
  
  // Spawn wandering particles
  for (let i = 0; i < numParticles; i++) {
    spawnParticle();
  }
}

function spawnParticle() {
  // Spawn from edges
  let side = floor(random(4));
  let x, y;
  
  switch(side) {
    case 0: // top
      x = random(width);
      y = random(-50, -10);
      break;
    case 1: // right
      x = random(width + 10, width + 50);
      y = random(height);
      break;
    case 2: // bottom
      x = random(width);
      y = random(height + 10, height + 50);
      break;
    case 3: // left
      x = random(-50, -10);
      y = random(height);
      break;
  }
  
  particles.push({
    x: x,
    y: y,
    vx: random(-1, 1),
    vy: random(-1, 1),
    col: random(colorPalette),
    attempts: 0
  });
}

function draw() {
  if (!animating) return;
  
  // Draw faint trails
  noStroke();
  fill(10, 5);
  rect(0, 0, width, height);
  
  // Update and draw wandering particles
  for (let i = particles.length - 1; i >= 0; i--) {
    let p = particles[i];
    
    // Random walk with slight drift toward center
    p.vx += random(-0.5, 0.5);
    p.vy += random(-0.5, 0.5);
    
    // Gentle pull toward center
    let dx = width/2 - p.x;
    let dy = height/2 - p.y;
    let d = sqrt(dx*dx + dy*dy);
    if (d > 50) {
      p.vx += dx * 0.0001;
      p.vy += dy * 0.0001;
    }
    
    // Limit velocity
    let speed = sqrt(p.vx*p.vx + p.vy*p.vy);
    if (speed > 3) {
      p.vx = (p.vx / speed) * 3;
      p.vy = (p.vy / speed) * 3;
    }
    
    p.x += p.vx;
    p.y += p.vy;
    p.attempts++;
    
    // Draw particle
    noStroke();
    fill(hue(p.col), saturation(p.col), brightness(p.col), 0.6);
    circle(p.x, p.y, radius * 1.5);
    
    // Check for collision with stuck particles
    for (let sp of stuckParticles) {
      let d = dist(p.x, p.y, sp.x, sp.y);
      if (d < radius * 2.5) {
        // Stick!
        stuckParticles.push({
          x: p.x,
          y: p.y,
          col: p.col
        });
        
        // Draw stuck particle with glow
        fill(p.col);
        circle(p.x, p.y, radius * 2);
        
        // Add glow effect
        for (let g = 0; g < 3; g++) {
          fill(hue(p.col), saturation(p.col), brightness(p.col), 0.2 - g * 0.05);
          circle(p.x, p.y, radius * 2 + g * 4);
        }
        
        stuckCount++;
        
        // Remove from wandering particles
        particles.splice(i, 1);
        
        // Spawn new particle
        if (stuckCount < 8000) {
          spawnParticle();
        }
        
        break;
      }
    }
    
    // Remove if too many attempts or out of bounds
    if (p.attempts > maxAttempts || p.x < -100 || p.x > width + 100 || p.y < -100 || p.y > height + 100) {
      particles.splice(i, 1);
      if (stuckCount < 8000) {
        spawnParticle();
      }
    }
  }
  
  // Stop when enough particles stuck
  if (stuckCount >= 8000) {
    animating = false;
  }
}

function windowResized() {
  resizeCanvas(windowWidth, windowHeight);
  background(10);
}
</script>
</body>
</html>
