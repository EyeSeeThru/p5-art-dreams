<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>recursive-ember</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.9.0/p5.min.js"></script>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { overflow: hidden; background: #0a0305; }
    canvas { display: block; }
  </style>
</head>
<body>
<script>
// RECURSIVE EMBER - Fractal embers rising with recursive branching
let time = 0;
let embers = [];
let numEmbers = 25;
let branches = [];

function setup() {
  createCanvas(windowWidth, windowHeight);
  colorMode(HSB, 360, 100, 100, 1);
  
  // Initialize embers at bottom
  for (let i = 0; i < numEmbers; i++) {
    createEmber(random(width), height + random(50));
  }
}

function createEmber(x, y) {
  embers.push({
    x: x,
    y: y,
    vx: random(-0.8, 0.8),
    vy: random(-2, -0.5),
    size: random(3, 12),
    hue: random(0, 60),
    branch: true,
    branches: [],
    life: 1,
    decay: random(0.001, 0.003),
    wobble: random(0.02, 0.06),
    wobblePhase: random(TWO_PI),
    glow: random(0.5, 1)
  });
}

function draw() {
  background(10, 40, 3, 0.15);
  
  time += 0.015;
  
  // Draw rising heat distortion
  drawHeatHaze();
  
  // Update and draw embers
  for (let i = embers.length - 1; i >= 0; i--) {
    let e = embers[i];
    
    // Update position
    e.wobblePhase += e.wobble;
    e.x += e.vx + sin(e.wobblePhase) * 0.5;
    e.y += e.vy;
    e.vy *= 0.995;
    e.life -= e.decay;
    
    // Branching recursion
    if (e.branch && e.life > 0.6 && random() < 0.015) {
      branchEmber(e);
    }
    
    // Draw ember
    drawEmber(e);
    
    // Remove dead embers
    if (e.life <= 0 || e.y < -50) {
      embers.splice(i, 1);
      // Respawn at bottom
      createEmber(random(width), height + random(30, 100));
    }
  }
  
  // Draw all branches
  for (let b of branches) {
    updateBranch(b);
    drawBranch(b);
  }
  
  // Clean up dead branches
  branches = branches.filter(b => b.life > 0);
  
  // Draw ground glow
  drawGroundGlow();
}

function branchEmber(parent) {
  let angle = random(-PI/3, PI/3);
  branches.push({
    x: parent.x,
    y: parent.y,
    vx: parent.vx + cos(angle) * 1.5,
    vy: parent.vy + sin(angle) * 1.5,
    size: parent.size * 0.6,
    hue: parent.hue + random(-10, 10),
    life: parent.life * 0.8,
    decay: parent.decay * 1.2,
    age: 0,
    maxAge: random(30, 80)
  });
}

function updateBranch(b) {
  b.x += b.vx;
  b.y += b.vy;
  b.vy -= 0.02; // Upward acceleration
  b.vx *= 0.98;
  b.life -= b.decay;
  b.age++;
}

function drawBranch(b) {
  let alpha = b.life * 0.8;
  
  noStroke();
  
  // Outer glow
  fill(b.hue, 80, 50, alpha * 0.2);
  ellipse(b.x, b.y, b.size * 4);
  
  // Inner glow  
  fill(b.hue, 60, 70, alpha * 0.4);
  ellipse(b.x, b.y, b.size * 2);
  
  // Core
  fill(b.hue, 40, 90, alpha);
  ellipse(b.x, b.y, b.size);
  
  // Bright center
  fill(b.hue, 10, 100, alpha * 0.8);
  ellipse(b.x, b.y, b.size * 0.4);
}

function drawEmber(e) {
  let alpha = e.life;
  let flicker = sin(time * 8 + e.wobblePhase * 10) * 0.15 + 0.85;
  let size = e.size * flicker;
  
  noStroke();
  
  // Large glow
  fill(e.hue, 70, 40, alpha * 0.1 * e.glow);
  ellipse(e.x, e.y, size * 6);
  
  // Medium glow
  fill(e.hue, 60, 50, alpha * 0.25 * e.glow);
  ellipse(e.x, e.y, size * 3);
  
  // Inner bright
  fill(e.hue, 50, 80, alpha * 0.5);
  ellipse(e.x, e.y, size * 1.5);
  
  // Core white hot
  fill(e.hue, 20, 100, alpha * 0.9);
  ellipse(e.x, e.y, size * 0.6);
  
  // Trailing particles
  if (e.life > 0.5) {
    for (let i = 0; i < 3; i++) {
      let tx = e.x + random(-size, size);
      let ty = e.y + random(0, size * 2);
      let ta = alpha * random(0.2, 0.5);
      let ts = random(1, 3);
      
      fill(e.hue, 50, 70, ta);
      ellipse(tx, ty, ts);
    }
  }
}

function drawHeatHaze() {
  let cx = width / 2;
  
  noStroke();
  
  for (let i = 0; i < 5; i++) {
    let y = height - i * 80 - 100;
    let w = width * (0.3 + i * 0.15);
    let alpha = map(i, 0, 5, 0.08, 0.02);
    
    fill(25, 60, 20, alpha);
    ellipse(cx, y, w, 40);
  }
}

function drawGroundGlow() {
  let cx = width / 2;
  let cy = height;
  
  noStroke();
  
  // Multiple layers of ground glow
  for (let i = 10; i >= 0; i--) {
    let w = width * (0.4 + i * 0.08);
    let h = 100 + i * 20;
    let alpha = map(i, 0, 10, 0.15, 0);
    
    fill(20, 70, 30, alpha);
    ellipse(cx, cy, w, h);
  }
}

function windowResized() {
  resizeCanvas(windowWidth, windowHeight);
}
</script>
</body>
</html>
